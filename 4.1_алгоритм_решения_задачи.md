# 4.1 Алгоритм решения задачи

Разработка веб-приложения осуществлялась по итеративному подходу с поэтапной реализацией функциональности.

## 4.1.1 Общий алгоритм работы системы

**Алгоритм работы с каталогом экспонатов:**

```
1. Пользователь открывает страницу каталога
2. Система загружает список публичных экспонатов из базы данных
3. Применяются фильтры (если заданы):
   - По категории
   - По году создания
   - По наличию 3D модели
4. Применяется поисковый запрос (если задан):
   - Поиск по названию, описанию, категории, автору, руководителю
5. Результаты сортируются по дате создания (новые первыми)
6. Применяется пагинация (6 экспонатов на страницу)
7. Отображаются карточки экспонатов с превью-изображениями
8. Пользователь может кликнуть на карточку для перехода к детальной странице
```

**Алгоритм работы виртуальной галереи:**

```
1. Пользователь открывает страницу виртуальной галереи
2. Система инициализирует Three.js сцену и камеру
3. Загружаются экспонаты с visibleInGallery = true
4. Для каждого экспоната:
   a. Если есть 3D модель (has3DModel = true):
      - Загружается GLB/GLTF модель из modelPath
      - Позиционируется по координатам (galleryPositionX, Y, Z)
      - Применяется масштаб (galleryScale)
      - Применяется поворот (galleryRotationY)
   b. Если нет 3D модели:
      - Создается плоскость с превью-изображением
      - Позиционируется аналогично
5. Инициализируются контроллеры камеры (FirstPersonControls)
6. Запускается игровой цикл рендеринга (requestAnimationFrame)
7. При клике на экспонат:
   - Открывается модальное окно с детальной информацией
   - Или происходит переход на страницу экспоната
```

**Алгоритм работы административной панели:**

```
1. Администратор вводит логин и пароль
2. Система проверяет учетные данные
3. При успешной аутентификации:
   - Сохраняется сессия в localStorage и cookies
   - Устанавливается роль (admin/super)
4. Администратор получает доступ к функциям:
   a. Просмотр списка всех экспонатов
   b. Создание нового экспоната:
      - Заполнение формы с данными
      - Загрузка изображений
      - Загрузка 3D модели (опционально)
      - Создание или выбор научного руководителя
      - Сохранение в базу данных
   c. Редактирование экспоната:
      - Загрузка существующих данных
      - Изменение полей
      - Обновление медиа-файлов
      - Сохранение изменений
   d. Удаление экспоната
   e. Редактирование позиции в галерее (для super-admin):
      - Открытие редактора галереи
      - Перемещение экспоната в 3D пространстве
      - Сохранение координат, масштаба, поворота
```

## 4.1.2 Алгоритм поиска и фильтрации

**Алгоритм поиска:**

```javascript
function searchExhibits(query, exhibits) {
  const lowerQuery = query.toLowerCase()
  const queryWords = lowerQuery.split(' ').filter(w => w.length > 0)
  
  return exhibits.filter(exhibit => {
    const searchableText = [
      exhibit.title,
      exhibit.description,
      exhibit.category,
      exhibit.studentName,
      exhibit.supervisor?.name
    ].join(' ').toLowerCase()
    
    return queryWords.some(word => 
      searchableText.includes(word)
    )
  })
}
```

**Алгоритм фильтрации:**

```javascript
function filterExhibits(exhibits, filters) {
  return exhibits.filter(exhibit => {
    // Фильтр по категории
    if (filters.category && exhibit.category !== filters.category) {
      return false
    }
    
    // Фильтр по году
    if (filters.year && exhibit.year !== filters.year) {
      return false
    }
    
    // Фильтр по наличию 3D модели
    if (filters.only3D && !exhibit.has3DModel) {
      return false
    }
    
    return true
  })
}
```

## 4.1.3 Алгоритм позиционирования в 3D галерее

**Алгоритм размещения экспоната:**

```
1. Администратор открывает редактор галереи
2. Загружаются все экспонаты с visibleInGallery = true
3. Экспонаты отображаются в 3D пространстве
4. Администратор выбирает экспонат для редактирования
5. При перемещении экспоната:
   a. Обновляются координаты в реальном времени
   b. Проверяется расстояние до других экспонатов (опционально)
   c. Визуально отображается новая позиция
6. При изменении масштаба:
   a. Обновляется значение galleryScale
   b. Применяется трансформация к модели
7. При повороте:
   a. Обновляется значение galleryRotationY
   b. Применяется поворот вокруг оси Y
8. При сохранении:
   a. Отправляется PUT запрос к API
   b. Обновляется запись в базе данных
   c. Изменения применяются в галерее
```

## 4.1.4 Алгоритм загрузки и обработки файлов

**Алгоритм загрузки изображения:**

```
1. Пользователь выбирает файл в форме
2. Проверяется тип файла (должен быть изображением)
3. Проверяется размер файла (< 10 MB)
4. Генерируется уникальное имя файла (UUID + timestamp)
5. Файл сохраняется в public/images/
6. Путь к файлу возвращается в ответе
7. Путь сохраняется в поле previewImage или добавляется в массив images
```

**Алгоритм загрузки 3D модели:**

```
1. Пользователь выбирает GLB/GLTF файл
2. Проверяется расширение файла (.glb или .gltf)
3. Проверяется размер файла (< 50 MB)
4. Генерируется уникальное имя файла
5. Файл сохраняется в public/models/
6. Путь к файлу сохраняется в поле modelPath
7. Устанавливается флаг has3DModel = true
```
