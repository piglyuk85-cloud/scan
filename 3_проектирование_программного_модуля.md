# 3 Проектирование программного модуля

## 3.1 Архитектура системы

Архитектура веб-приложения для каталогизации и управления экспонатами спроектирована с учетом требований к функциональности, производительности и масштабируемости. Система построена по модульному принципу с четким разделением на клиентскую и серверную части.

Приложение использует архитектуру Next.js 14 с App Router, что обеспечивает серверный рендеринг страниц и возможность создания API endpoints без необходимости отдельного backend-сервера. Клиентская часть реализована на React с использованием TypeScript для обеспечения типобезопасности. Серверная часть представлена API routes Next.js, которые обрабатывают запросы к базе данных через Prisma ORM.

Система разделена на несколько функциональных модулей. Публичный модуль обеспечивает просмотр каталога экспонатов, поиск и фильтрацию, просмотр детальной информации об экспонатах и навигацию по виртуальной 3D галерее. Административный модуль предоставляет функционал управления экспонатами, включая создание, редактирование и удаление записей, загрузку медиа-файлов, редактирование позиционирования экспонатов в 3D пространстве и управление контентом страниц сайта.

Взаимодействие между модулями осуществляется через RESTful API, что обеспечивает разделение логики и возможность независимого развития компонентов. База данных SQLite хранит всю информацию об экспонатах, научных руководителях и контенте страниц, обеспечивая целостность данных через внешние ключи и индексы.

## 3.2 Проектирование базы данных

Проектирование базы данных осуществлялось с учетом требований нормализации до третьей нормальной формы (3NF) для обеспечения целостности данных, устранения избыточности и оптимизации производительности запросов.

### 3.2.1 Концептуальная модель данных

Концептуальная модель представляет основные сущности предметной области и связи между ними. Основными сущностями являются Exhibit (Экспонат), представляющая студенческую работу, Supervisor (Научный руководитель), представляющая преподавателя-руководителя, и PageContent (Контент страниц), предназначенная для хранения редактируемого текстового контента сайта.

Связь между сущностями Exhibit и Supervisor реализована как связь "многие-к-одному" (Many-to-One), где один научный руководитель может курировать множество экспонатов, а каждый экспонат имеет одного научного руководителя опционально. Эта связь реализована через внешний ключ `supervisorId` в таблице `Exhibit`, что обеспечивает целостность данных и устраняет транзитивные зависимости.

### 3.2.2 Логическая модель данных

Логическая модель реализована в виде реляционной схемы базы данных SQLite с использованием Prisma ORM. Основная таблица Exhibit содержит информацию об экспонатах и включает поля для идентификации (id, inventoryNumber, title), описания (description, fullDescription, creationInfo), классификации (category, year, creationDate), информации об авторе (studentName, studentCourse, studentGroup), связи с научным руководителем (supervisorId), технических характеристик (dimensions, currentLocation), медиа-контента (previewImage, images, modelPath, has3DModel), позиционирования в галерее (galleryPositionX, galleryPositionY, galleryPositionZ, galleryScale, galleryRotationY, visibleInGallery) и метаданных (isPublic, createdAt, updatedAt).

Таблица Supervisor выделена в отдельную таблицу для соответствия требованиям третьей нормальной формы и устранения транзитивных зависимостей. Она содержит поля id, name (уникальное), position, rank, department, а также служебные поля createdAt и updatedAt. Связь с экспонатами реализована через отношение один-ко-многим.

Таблица PageContent предназначена для хранения редактируемого контента страниц сайта и имеет упрощенную структуру с полями id (всегда "singleton"), content (JSON-структура) и updatedAt.

Для оптимизации производительности запросов созданы индексы на полях category, year, studentName, supervisorId, visibleInGallery и isPublic в таблице Exhibit, а также уникальный индекс на поле name в таблице Supervisor.

### 3.2.3 Нормализация базы данных

База данных приведена к третьей нормальной форме (3NF) путем устранения транзитивных зависимостей. Информация о научных руководителях, включающая должность, звание и кафедру, вынесена в отдельную таблицу Supervisor, так как эти атрибуты зависят от самого руководителя, а не напрямую от экспоната. Это решение устраняет дублирование данных, когда один руководитель курирует множество экспонатов, аномалии обновления, когда изменение должности требует обновления только одной записи, аномалии удаления, когда информация о руководителе сохраняется при удалении экспонатов, и риск несогласованности данных.

Преимущества нормализации включают обеспечение целостности данных через внешние ключи, устранение избыточности информации, упрощение обновления данных и улучшение производительности запросов за счет эффективного использования индексов.

## 3.3 Проектирование пользовательского интерфейса

Проектирование пользовательского интерфейса осуществлялось с учетом требований к удобству использования, адаптивности и визуальной привлекательности. Интерфейс разделен на публичную и административную части, каждая из которых имеет специфические требования к дизайну и функциональности.

### 3.3.1 Структура публичных страниц

Главная страница приложения представляет собой точку входа для всех пользователей и включает несколько ключевых секций. Hero-секция содержит приветственное сообщение, название проекта и краткое описание, оформленное с использованием градиентного фона для привлечения внимания. Секция "О виртуальной галерее" предоставляет подробную информацию о проекте, его назначении и возможностях. Блок с популярными работами отображает топ-6 экспонатов в виде карточек с превью-изображениями, что позволяет пользователям быстро ознакомиться с коллекцией. Статистический блок показывает общее количество работ в каталоге, что дает представление о масштабе коллекции. Навигационные ссылки обеспечивают быстрый переход к основным разделам сайта: каталогу, виртуальной галерее и странице "О проекте".

Страница каталога экспонатов является центральным элементом публичной части приложения. Она включает панель поиска и фильтрации, позволяющую пользователям находить экспонаты по различным критериям. Результаты поиска отображаются в виде сетки карточек экспонатов, каждая из которых содержит превью-изображение, название, категорию и год создания. Пагинация обеспечивает удобную навигацию по большому количеству экспонатов, отображая по 6 экспонатов на странице. Фильтры по категориям и годам позволяют сузить область поиска, а опция "Только с 3D моделями" помогает найти экспонаты с интерактивным просмотром.

Страница детального просмотра экспоната предоставляет полную информацию о выбранной работе. Заголовок страницы содержит название экспоната и кнопку возврата в каталог. Галерея изображений реализована в виде слайдера, позволяющего просматривать все изображения экспоната. Полное описание содержит детальную информацию о работе, включая историю создания, стилистику и символику. Блок информации об авторе включает ФИО студента, курс и группу, а блок информации о научном руководителе содержит ФИО, должность, звание и кафедру. Дополнительные характеристики включают размеры, местонахождение и инвентарный номер. Если экспонат имеет 3D модель, отображается интерактивный просмотрщик с возможностью вращения и масштабирования модели. QR-код для быстрого доступа позволяет пользователям сохранить ссылку на экспонат или использовать её в физических выставках. Навигация между экспонатами обеспечивает переход к предыдущему или следующему экспонату в каталоге.

Страница виртуальной 3D галереи представляет собой интерактивное трехмерное пространство для просмотра экспонатов. Галерея загружает все экспонаты с флагом visibleInGallery и отображает их в трехмерном пространстве согласно заданным координатам. Экспонаты с 3D моделями отображаются в виде загруженных моделей, а экспонаты без моделей — в виде плоскостей с превью-изображениями. Система навигации использует first-person controls, позволяя пользователям перемещаться по галерее с помощью клавиш WASD и управлять камерой с помощью мыши. При клике на экспонат открывается модальное окно с детальной информацией или происходит переход на страницу экспоната.

Страница "О проекте" содержит информацию о виртуальной галерее, университете, описании работы системы и контактной информации. Контент этой страницы может редактироваться администраторами через специальный редактор.

### 3.3.2 Структура административных страниц

Административная панель предназначена для управления контентом системы и доступна только авторизованным администраторам. Страница входа требует ввода логина и пароля, после успешной аутентификации пользователь получает доступ к функциям управления в соответствии со своим уровнем доступа.

Главная страница административной панели содержит список всех экспонатов, включая приватные, с возможностью быстрого доступа к операциям создания, редактирования и удаления. Каждая запись в списке отображает основную информацию об экспонате: название, категорию, автора, статус публичности и дату создания. Фильтры и поиск позволяют администратору быстро находить нужные экспонаты среди большого количества записей.

Страница создания и редактирования экспоната представляет собой комплексную форму, разделенную на логические блоки. Блок идентификации содержит поля для инвентарного номера, названия и описания. Блок классификации включает категорию, дату создания и год. Блок информации об авторе содержит поля для ФИО студента, курса и группы. Блок информации о научном руководителе позволяет выбрать существующего руководителя из базы данных или создать нового с указанием должности, звания и кафедры. Блок технических характеристик включает размеры и местонахождение. Блок медиа-контента обеспечивает загрузку превью-изображения, галереи изображений и 3D модели с валидацией типов и размеров файлов. Блок дополнительной информации содержит поля для истории создания, технических характеристик, интересных фактов и связанных экспонатов. Блок настроек видимости позволяет управлять публичностью экспоната и его видимостью в виртуальной галерее.

Редактор галереи доступен только для супер-администраторов и позволяет визуально позиционировать экспонаты в трехмерном пространстве. Интерфейс редактора включает трехмерную сцену с отображением всех экспонатов, панель выбора экспоната для редактирования, панель управления позицией с полями для координат X, Y, Z, панель управления трансформацией с полями для масштаба и поворота, а также кнопки сохранения изменений. Навигация по галерее в редакторе осуществляется с помощью клавиш WASD, что позволяет администратору перемещаться и визуально оценивать размещение экспонатов.

Редактор контента страниц позволяет супер-администраторам редактировать текстовый контент сайта через JSON-редактор. Интерфейс включает структурированное представление контента с возможностью редактирования текстовых полей, предпросмотр изменений и сохранение обновленного контента в базу данных.

### 3.3.3 Компонентная архитектура интерфейса

Пользовательский интерфейс построен на компонентном подходе React, что обеспечивает модульность и переиспользуемость кода. Навигационный компонент Navbar присутствует на всех страницах и обеспечивает быстрый доступ к основным разделам сайта, а также содержит условное отображение ссылки на административную панель для авторизованных пользователей. Компонент Footer отображается в нижней части страниц и содержит информацию о проекте, навигационные ссылки и контактную информацию.

Компонент ExhibitCard используется для отображения экспоната в виде карточки в каталоге и на главной странице. Он включает превью-изображение, название, категорию, год создания и обеспечивает переход на страницу детального просмотра при клике. Компонент SafeImage обеспечивает безопасное отображение изображений с обработкой ошибок загрузки и отображением заглушки при отсутствии изображения. Компонент SafeModel аналогично обеспечивает безопасную загрузку и отображение 3D моделей с обработкой ошибок.

Компонент VirtualGallery реализует виртуальную 3D галерею с использованием Three.js и React Three Fiber. Он включает инициализацию 3D сцены, загрузку экспонатов, позиционирование их в пространстве, систему навигации и обработку взаимодействий. Компонент FirstPersonControls обеспечивает управление камерой в режиме от первого лица, а компонент MobileControls предоставляет альтернативное управление для мобильных устройств с сенсорным экраном.

Компонент ModelViewer обеспечивает интерактивный просмотр 3D моделей на странице экспоната с возможностью вращения, масштабирования и панорамирования. Компонент QRCodeDisplay генерирует и отображает QR-код для экспоната, обеспечивая быстрый доступ к странице экспоната через сканирование.

В административной панели используются специализированные компоненты. Компонент ExhibitForm представляет комплексную форму для создания и редактирования экспонатов с валидацией полей и обработкой загрузки файлов. Компонент ExhibitList отображает список экспонатов с возможностью фильтрации, поиска и управления. Компонент PageContentEditor предоставляет интерфейс для редактирования контента страниц через JSON-редактор.

### 3.3.4 Адаптивный дизайн

Проектирование интерфейса учитывает необходимость работы на различных устройствах с разными размерами экранов. Адаптивность обеспечивается использованием Tailwind CSS с responsive breakpoints. На десктопных устройствах интерфейс использует полную ширину экрана с оптимальным использованием пространства. На планшетах элементы интерфейса перестраиваются для удобного просмотра, сохраняя основную функциональность. На мобильных устройствах интерфейс оптимизирован для сенсорного управления с увеличенными областями нажатия и упрощенной навигацией.

Виртуальная 3D галерея адаптируется для мобильных устройств, используя альтернативные контроллы для управления камерой, оптимизированные для сенсорного экрана. Размеры 3D моделей и элементов интерфейса автоматически масштабируются в зависимости от размера экрана, обеспечивая комфортный просмотр на любом устройстве.

## 3.4 Выбор технологий и инструментов

Выбор технологий для разработки веб-приложения осуществлялся с учетом требований к функциональности, производительности, масштабируемости и удобству разработки.

### 3.4.1 Frontend Framework: Next.js 14

Next.js 14 выбран как основной фреймворк для разработки по нескольким причинам. Server-Side Rendering (SSR) обеспечивает быструю загрузку страниц и улучшает SEO-оптимизацию. App Router предоставляет современную систему маршрутизации с поддержкой серверных компонентов. Встроенная поддержка API Routes позволяет создавать API endpoints без необходимости отдельного backend-сервера. Встроенный компонент Image обеспечивает автоматическую оптимизацию изображений. Нативная поддержка TypeScript гарантирует типобезопасность кода. Большое сообщество разработчиков обеспечивает обширную документацию и библиотеки.

### 3.4.2 Язык программирования: TypeScript

TypeScript выбран для повышения надежности кода благодаря статической типизации, которая позволяет выявлять ошибки на этапе компиляции. Улучшенная поддержка IDE обеспечивает автодополнение и рефакторинг. Явные типы делают код более понятным и читаемым. Совместимость с JavaScript позволяет использовать существующие библиотеки без изменений.

### 3.4.3 База данных: SQLite с Prisma ORM

SQLite выбран как система управления базами данных благодаря легковесности, так как не требует отдельного сервера базы данных. Простота развертывания обеспечивается тем, что база данных хранится в одном файле. Для средних объемов данных SQLite обеспечивает достаточную производительность. ACID транзакции гарантируют целостность данных. Отсутствие лицензионных ограничений делает решение экономически выгодным.

Prisma ORM выбран для работы с базой данных благодаря автоматической генерации типов из схемы, что обеспечивает type-safe запросы. Система миграций позволяет управлять версиями схемы базы данных. Интуитивный синтаксис обеспечивает удобный API для работы с данными. Поддержка в IDE обеспечивает автодополнение. Подробная документация и примеры упрощают разработку.

### 3.4.4 Стилизация: Tailwind CSS

Tailwind CSS выбран для стилизации интерфейса благодаря utility-first подходу, который позволяет быстро создавать интерфейсы. Встроенная поддержка responsive design обеспечивает адаптивность. Легко настраиваемая тема позволяет кастомизировать дизайн. Автоматическое удаление неиспользуемых стилей улучшает производительность. Готовые компоненты и утилиты обеспечивают современный дизайн.

### 3.4.5 3D графика: Three.js и React Three Fiber

Three.js является наиболее популярной библиотекой для 3D графики в веб, что обеспечивает широкую поддержку и обширную документацию. React Three Fiber представляет React-обертку для Three.js, обеспечивающую декларативный подход к работе с 3D сценами. Оптимизированная работа с WebGL обеспечивает высокую производительность. Поддержка форматов GLB/GLTF позволяет загружать 3D модели. Поддержка контроллеров камеры и взаимодействия обеспечивает интерактивность.

### 3.4.6 Дополнительные библиотеки

Для расширения функциональности используются дополнительные библиотеки. Библиотека jsqr обеспечивает распознавание QR-кодов с камеры устройства. Библиотека qrcode позволяет генерировать QR-коды для экспонатов. Компонент next/image обеспечивает оптимизацию изображений. Библиотека react-hook-form может использоваться для управления формами при необходимости.

## 3.5 Технические требования

Технические требования к системе определяют необходимые характеристики серверного и клиентского оборудования, производительность, безопасность, масштабируемость и условия развертывания.

### 3.5.1 Требования к серверу

Минимальные требования к серверу включают процессор с двумя ядрами, оперативную память объемом 2 GB, свободное место на диске 10 GB и операционную систему Linux (Debian/Ubuntu) или Windows Server. Рекомендуемые требования предусматривают процессор с четырьмя ядрами, оперативную память объемом 4 GB, свободное место на диске 20 GB и операционную систему Linux (Debian 13+).

### 3.5.2 Требования к клиенту

Система поддерживает современные браузеры, включая Chrome 90+, Firefox 88+, Safari 14+ и Edge 90+. Для десктопных устройств рекомендуется разрешение 1920x1080 и выше, для планшетов — разрешение 768x1024 и выше, для мобильных устройств — разрешение 375x667 и выше. Для работы виртуальной 3D галереи требуется поддержка WebGL 2.0, аппаратное ускорение графики и минимум 2 GB оперативной памяти на устройстве.

### 3.5.3 Требования к производительности

Время загрузки страниц должно составлять менее 2 секунд для главной страницы, менее 3 секунд для каталога, менее 2 секунд для страницы экспоната и менее 5 секунд для виртуальной галереи, включая загрузку 3D моделей. Производительность базы данных должна обеспечивать поиск по каталогу за время менее 500 мс, загрузку списка экспонатов за время менее 1 секунды и запрос одного экспоната за время менее 100 мс. Оптимизация 3D моделей требует размера файла менее 5 MB на модель, количества полигонов менее 50,000 на модель и использования формата GLB (бинарный GLTF).

### 3.5.4 Требования к безопасности

Аутентификация администраторов должна обеспечивать хранение паролей в зашифрованном виде с возможностью перехода на хеширование в будущем, использование сессий с ограниченным временем жизни и разделение прав доступа между администраторами и супер-администраторами. Валидация данных должна включать проверку типов загружаемых файлов, ограничение размера файлов и санитизацию пользовательского ввода. Защита от атак должна обеспечивать защиту от SQL-инъекций через использование Prisma ORM, защиту от XSS через санитизацию вывода и настройку CORS для API.

### 3.5.5 Требования к масштабируемости

Система должна поддерживать до 10,000 экспонатов в базе данных, до 100 одновременных пользователей и до 1,000 запросов в минуту. При необходимости масштабирования предусмотрена возможность миграции на PostgreSQL или MySQL, использование кэширования через Redis, применение CDN для статических файлов и горизонтальное масштабирование через Docker.

### 3.5.6 Требования к развертыванию

Среда разработки требует Node.js версии 18 и выше, npm версии 9 и выше, а также Git для контроля версий. Production среда требует Node.js версии 18 LTS и выше, PM2 или systemd для управления процессами, Nginx в качестве reverse proxy и Docker опционально для контейнеризации. Резервное копирование должно обеспечивать ежедневное резервное копирование базы данных, хранение резервных копий на отдельном носителе и наличие плана восстановления после сбоев.
