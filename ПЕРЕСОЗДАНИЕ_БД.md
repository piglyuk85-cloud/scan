# Пересоздание базы данных

Простой способ решить проблему с миграцией - удалить старую БД и создать новую.

## ⚠️ ВНИМАНИЕ: Это удалит все данные из базы данных!

Если у вас есть важные данные, сначала сделайте резервную копию:

```bash
# Резервная копия
cp prisma/prod.db prisma/prod.db.backup.$(date +%Y%m%d_%H%M%S)
```

## Шаги для пересоздания БД

### Вариант 1: Если используется Docker

```bash
cd /root/Scan

# Останавливаем приложение
docker-compose -f docker-compose.prod.yml down

# Удаляем старую базу данных
rm -f prisma/prod.db prisma/dev.db

# Применяем все миграции (создаст новую БД)
docker-compose -f docker-compose.prod.yml run --rm virtual-gallery npx prisma migrate deploy

# Перегенерируем Prisma Client
docker-compose -f docker-compose.prod.yml run --rm virtual-gallery npx prisma generate

# Запускаем приложение
docker-compose -f docker-compose.prod.yml up -d
```

### Вариант 2: Если без Docker

```bash
cd /root/Scan

# Останавливаем приложение (если запущено)
pm2 stop museum-app  # или как вы останавливаете

# Удаляем старую базу данных
rm -f prisma/prod.db prisma/dev.db

# Применяем все миграции (создаст новую БД)
npx prisma migrate deploy

# Перегенерируем Prisma Client
npx prisma generate

# Запускаем приложение
pm2 start museum-app  # или npm start
```

## Восстановление данных (если нужно)

Если у вас были данные и вы хотите их восстановить:

1. **Если данные были в JSON файлах:**
```bash
npm run migrate:data
```

2. **Если данные были в seed скрипте:**
```bash
tsx scripts/seed-db.ts
```

## Проверка

После пересоздания проверьте:

```bash
# Проверка структуры БД
npx prisma db pull

# Или через Prisma Studio
npx prisma studio
```

Готово! База данных пересоздана с правильной структурой.
