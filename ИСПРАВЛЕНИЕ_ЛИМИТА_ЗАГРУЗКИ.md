# Исправление ошибки 413 (Request Entity Too Large) при загрузке 3D моделей

Ошибка возникает из-за ограничений размера загружаемых файлов в Nginx и Next.js.

## Что было исправлено в коде:

1. ✅ Увеличен лимит в `next.config.js` до 100MB
2. ✅ Добавлены настройки в `app/api/upload/route.ts` (maxDuration)
3. ✅ Увеличен лимит в `nginx-ip-config.conf` до 100MB

## Что нужно сделать на сервере:

### 1. Обновить конфигурацию Nginx

Если используется Nginx, нужно обновить конфигурацию:

```bash
# Скопировать обновленную конфигурацию
sudo cp nginx-ip-config.conf /etc/nginx/sites-available/museum-app

# Или отредактировать существующую конфигурацию
sudo nano /etc/nginx/sites-available/museum-app
```

Убедитесь, что в конфигурации есть:
```nginx
client_max_body_size 100M;
```

Затем перезагрузите Nginx:
```bash
sudo nginx -t  # Проверить конфигурацию
sudo systemctl reload nginx  # Перезагрузить
```

### 2. Пересобрать и перезапустить приложение

```bash
cd /root/Scan

# Если используется Docker
docker-compose -f docker-compose.prod.yml down
docker-compose -f docker-compose.prod.yml build
docker-compose -f docker-compose.prod.yml up -d

# Если без Docker
npm run build
pm2 restart museum-app
```

### 3. Проверить переменные окружения (опционально)

Если проблема сохраняется, можно добавить переменную окружения в `.env`:

```bash
# Добавить в .env файл
NEXT_BODY_SIZE_LIMIT=104857600  # 100MB в байтах
```

## Проверка

После применения изменений попробуйте загрузить 3D модель снова. Теперь должны поддерживаться файлы до 100MB.

## Если проблема сохраняется:

1. Проверьте логи Nginx: `sudo tail -f /var/log/nginx/error.log`
2. Проверьте логи приложения: `pm2 logs museum-app` или `docker-compose logs -f`
3. Убедитесь, что файл действительно меньше 100MB
