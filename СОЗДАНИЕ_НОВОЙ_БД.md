# Создание новой базы данных без миграций

Полностью пересоздаем базу данных из схемы Prisma, удаляя все существующие данные.

## ⚠️ ВНИМАНИЕ: Это удалит ВСЕ данные из базы данных!

## Шаги

### Вариант 1: Если используется Docker

```bash
cd /root/Scan

# Останавливаем приложение
docker-compose -f docker-compose.prod.yml down

# Полностью сбрасываем БД и создаем новую из схемы
docker-compose -f docker-compose.prod.yml run --rm virtual-gallery npx prisma migrate reset --force --skip-seed

# Перегенерируем Prisma Client
docker-compose -f docker-compose.prod.yml run --rm virtual-gallery npx prisma generate

# Запускаем приложение
docker-compose -f docker-compose.prod.yml up -d
```

### Вариант 2: Если без Docker

```bash
cd /root/Scan

# Останавливаем приложение (если запущено)
pm2 stop museum-app  # или как вы останавливаете

# Полностью сбрасываем БД и создаем новую из схемы
npx prisma migrate reset --force --skip-seed

# Перегенерируем Prisma Client
npx prisma generate

# Запускаем приложение
pm2 start museum-app  # или npm start
```

### Альтернативный вариант: Полное удаление и создание через db push

Если `migrate reset` не работает, можно вручную удалить все таблицы:

```bash
cd /root/Scan

# Останавливаем приложение
pm2 stop museum-app

# Удаляем БД полностью
rm -f prisma/prod.db prisma/dev.db prisma/*.db-journal

# Удаляем все таблицы через Prisma (если БД еще существует)
# Или просто создаем новую БД с нуля
npx prisma db push --force-reset --accept-data-loss

# Перегенерируем Prisma Client
npx prisma generate

# Запускаем приложение
pm2 start museum-app
```

## Что делает `prisma db push`

- Создает базу данных напрямую из `prisma/schema.prisma`
- Не использует миграции
- Автоматически синхронизирует структуру БД со схемой
- Идеально для разработки или когда нужно быстро пересоздать БД

## Восстановление данных (если нужно)

После создания новой БД можно восстановить данные:

```bash
# Если данные в JSON файлах
npm run migrate:data

# Или через seed скрипт
tsx scripts/seed-db.ts
```

Готово! База данных создана с правильной структурой.
